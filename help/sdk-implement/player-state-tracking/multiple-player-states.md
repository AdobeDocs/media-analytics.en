---
title: Updating multiple player states at once
description: This topic describes the Multiple Player State Tracking feature.
exl-id: a77bc882-ac03-40b4-ac64-87f26a09707b # TODO What is this value? What do I set it to?
feature: Media Analytics
role: User, Admin, Data Engineer
---
# Multiple Player States Tracking

There are situations when two player states start and end at the same time or when the end of a state is also the 
beginning of another state. Looking at the following example:

![Multiple player states](assets/multiple-player-states.svg)

The current implementation allows both scenarios:
- `stateStart(pictureInPicture)` - t0
- `stateStart(mute)` - t0
- `stateEnd(mute)` - t1
- `stateEnd(pictureInPicture)` - t1
- `stateStart(fullScreen)` - t1
- `stateEnd(fullScreen)` - t2

However, the client has to issue many `stateStart` and `stateEnd` events to signal multiple simultaneous state changes. In
order to optimize this common behavior, a new `statesUpdate` event type has been implemented, which ends a list of states
and starts a list of new states.

Using the new `statesUpdate` event, the above list of events becomes:
- `statesUpdate(statesEnd=[], statesStart=[pictureInPicture, mute])` - t0
- `statesUpdate(statesEnd=[mute, pictureInPicture], statesStart=[fullScreen])` - t1
- `statesUpdate(statesEnd=[fullScreen], statesStart=[])` - t2

The number of state updates calls has been reduced from 6 to only 3 for the same behavior. The last event
could also have been a simple `stateEnd(fullScreen)`.

## Media Collection API implementation

Examples:

```
// statesUpdate (ex: mute and pictureInPicture are switched on)
http(s)://<Analytics_Visitor_Namespace>.hb-api.omtrdc.net/api/v1/sessions/<SID>/events
{
  "eventType": "statesUpdate",
  "params": {
    "statesStart": [
      {
        "media.state.name": "mute"
      },
      {
        "media.state.name": "pictureInPicture"
      }
    ]
  },
  "playerTime": {
    "playhead": 0,
    "ts": 1569999130627
  }
}
```

```
// statesUpdate (ex: mute and pictureInPicture are switched off, fullScreen is switched on)
http(s)://<Analytics_Visitor_Namespace>.hb-api.omtrdc.net/api/v1/sessions/<SID>/events
{
  "eventType": "statesUpdate",
  "params": {
    "statesEnd": [
      {
        "media.state.name": "mute"
      },
      {
        "media.state.name": "pictureInPicture"
      }
    ],
    "statesStart": [
      {
        "media.state.name": "fullScreen"
      }
    ]
  },
  "playerTime": {
    "playhead": 0,
    "ts": 1569999130627
  }
}
```

```
// statesUpdate (ex: fullScreen is switched off)
http(s)://<Analytics_Visitor_Namespace>.hb-api.omtrdc.net/api/v1/sessions/<SID>/events
{
  "eventType": "statesUpdate",
  "params": {
    "statesEnd": [
      {
        "media.state.name": "fullScreen"
      }
    ]
  },
  "playerTime": {
    "playhead": 0,
    "ts": 1569999130627
  }
}
```

## Media SDK implementation

There is no Media SDK implementation.
